\c biztime

DROP TABLE IF EXISTS invoices;
DROP TABLE IF EXISTS companies;
DROP TABLE IF EXISTS industries;
DROP TABLE IF EXISTS companies_industries;

CREATE TABLE "companies" (
  "code" text PRIMARY KEY,
  "name" text UNIQUE NOT NULL,
  "description" text
);

CREATE TABLE "invoices" (
  "id" INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  "comp_code" text NOT NULL,
  "amt" float,
  "paid" boolean NOT NULL,
  "add_date" date,
  "paid_date" date
);

CREATE TABLE "industries" (
  "code" text PRIMARY KEY,
  "industry" text NOT NULL
);

CREATE TABLE "companies_industries" (
  "comp_code" text,
  "in_code" text,
  PRIMARY KEY ("comp_code", "in_code")
);

ALTER TABLE "companies_industries" ADD FOREIGN KEY ("comp_code") REFERENCES "companies" ("code");

ALTER TABLE "companies_industries" ADD FOREIGN KEY ("in_code") REFERENCES "industries" ("code");

ALTER TABLE "invoices" ADD FOREIGN KEY ("comp_code") REFERENCES "companies" ("code");

INSERT INTO companies
  VALUES ('apple', 'Apple Computer', 'Maker of OSX.'),
         ('ibm', 'IBM', 'Big blue.');

INSERT INTO invoices (comp_Code, amt, paid, paid_date)
  VALUES ('apple', 100, false, null),
         ('apple', 200, false, null),
         ('apple', 300, true, '2018-01-01'),
         ('ibm', 400, false, null);

INSERT INTO industries (code, industry)
  VALUES  ('soft', 'Software'),
          ('hard', 'Hardware'),
          ('cloud', 'Cloud Services'),
          ('web', 'Web Services');

INSERT INTO companies_industries (comp_code, in_code)
  VALUES  ('apple', 'soft'),
          ('apple', 'hard'),
          ('apple', 'cloud'),
          ('apple', 'web'),
          ('ibm', 'hard'),
          ('ibm', 'cloud');
